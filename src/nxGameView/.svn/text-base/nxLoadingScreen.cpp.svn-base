#include "nxLoadingScreen.hpp"
#include <nxGameApp/nxGameApp.hpp>
#include <nxGameApp/nxNexteroidsGameApp.hpp>

nxLoadingScreen::nxLoadingScreen()
{
	m_pGui = nxNexteroidsGameApp::GetInstance().VGetGui();
	m_TopContainer = NX_NEW gcn::Container();
    m_LoadingLabel = NX_NEW nxLabel(std::string("Loading..."));
    m_BackgroundIcon = NX_NEW gcn::Icon(NX_LOADING_FILENAME);
}

nxLoadingScreen::~nxLoadingScreen()
{
	nxNexteroidsGameApp::GetInstance().VGetTopContainer()->remove(m_TopContainer);
	NX_SAFE_DELETE(m_BackgroundIcon);
    NX_SAFE_DELETE(m_LoadingLabel);
    NX_SAFE_DELETE(m_TopContainer);
}

void nxLoadingScreen::Init()
{
	m_TopContainer->setDimension(gcn::Rectangle(0, 0, NX_SCREEN_WIDTH, NX_SCREEN_HEIGHT));
	m_TopContainer->setOpaque(false);
	nxNexteroidsGameApp::GetInstance().VGetTopContainer()->add(m_TopContainer);

	m_LoadingLabel->setPosition(NX_LABEL_X_OFFSET, NX_LABEL_Y_OFFSET);

	m_TopContainer->add(m_BackgroundIcon);
	m_TopContainer->add(m_LoadingLabel);
//    m_pGui->setTop(m_TopContainer);
}

void nxLoadingScreen::VOnUpdate(int deltaMilliseconds)
{
	m_pGui->logic();
}

void nxLoadingScreen::VOnRender()
{
	m_pGui->draw();

	SDL_GL_SwapBuffers();
}
